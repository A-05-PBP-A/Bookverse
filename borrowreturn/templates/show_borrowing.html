{% extends 'base.html' %}

<head>
    <title>Books You’re Enjoying Now</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </script>
    <style>
        .overdue {
            color: red;
        }
    </style>
</head>
{% block content %}
<h1 style="text-align: center;">Books You’re Enjoying Now</h1>
<div style="padding: 40px;">
    <div class="container">
        <div class="row" id="insert"></div>
    </div>
</div>


<script>
    
    async function getBorrowings() {
        return fetch("{% url 'borrowreturn:get_user_borrowing' %}").then((res) => res.json())
    }
    async function refreshItems() {
        let now = new Date();
        document.getElementById("insert").innerHTML = ""
        const borrowings = await getBorrowings()
        let htmlString = ``
        borrowings.forEach((item) => {
            let returnDate = new Date(item.fields.return_date);
            let isOverdue = returnDate < now ? 'overdue' : '';
            htmlString += `
                    <div class="col-md-3">
                        <div class="card" style="width: 15rem; height: 32rem; margin: 20px">
                            <img src="${item.fields.book.image_url_l}" class="card-img-top" alt="book image" style="height:20rem">
                            <div class="card-body" style="overflow: hidden;">
                                <h5 class="card-title" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">${item.fields.title}</h5>
                                <h6 class="card-subtitle mb-2 text-body-secondary">${item.fields.book.author}</h6>
                                <p class="card-text">${item.fields.book.publication_year}</p>
                                <p class="card-text">${item.fields.book.publisher}</p>
                                <p class="card-text">Return date: <span class="<span class="${isOverdue}"> ${item.fields.book.return_date} </span></p>
                            </div>
                        </div>
                    </div>`
        })

        document.getElementById("insert").innerHTML = htmlString
    }
    refreshItems()
</script>
{% endblock content %}